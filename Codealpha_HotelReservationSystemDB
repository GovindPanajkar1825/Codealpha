import java.sql.*;
import java.util.Scanner;

public class HotelReservationSystemDB {

    static final String URL = "jdbc:mysql://localhost:3306/hotel_db";
    static final String USER = "root";
    static final String PASS = "password";

    static Scanner sc = new Scanner(System.in);

    public static void main(String[] args) {

        while (true) {
            System.out.println("\n--- HOTEL RESERVATION SYSTEM ---");
            System.out.println("1. Search Rooms");
            System.out.println("2. Book Room");
            System.out.println("3. Cancel Reservation");
            System.out.println("4. View Bookings");
            System.out.println("5. Exit");
            System.out.print("Enter choice: ");

            int choice = sc.nextInt();
            sc.nextLine();

            switch (choice) {
                case 1 -> searchRooms();
                case 2 -> bookRoom();
                case 3 -> cancelReservation();
                case 4 -> viewBookings();
                case 5 -> System.exit(0);
                default -> System.out.println("Invalid choice!");
            }
        }
    }

    /* ---------- SEARCH ROOMS ---------- */
    static void searchRooms() {
        System.out.print("Enter category (Standard/Deluxe/Suite): ");
        String category = sc.nextLine();

        try (Connection con = DriverManager.getConnection(URL, USER, PASS)) {
            String sql = "SELECT * FROM rooms WHERE category=? AND is_available=true";
            PreparedStatement ps = con.prepareStatement(sql);
            ps.setString(1, category);

            ResultSet rs = ps.executeQuery();
            boolean found = false;

            while (rs.next()) {
                System.out.println("Room " + rs.getInt("room_number") +
                        " | ₹" + rs.getDouble("price"));
                found = true;
            }

            if (!found) {
                System.out.println("No rooms available.");
            }
        } catch (Exception e) {
            System.out.println("Database error.");
        }
    }

    /* ---------- BOOK ROOM ---------- */
    static void bookRoom() {
        System.out.print("Enter room number: ");
        int roomNo = sc.nextInt();
        sc.nextLine();

        System.out.print("Enter customer name: ");
        String name = sc.nextLine();

        System.out.print("Enter number of days: ");
        int days = sc.nextInt();

        try (Connection con = DriverManager.getConnection(URL, USER, PASS)) {

            String check = "SELECT price FROM rooms WHERE room_number=? AND is_available=true";
            PreparedStatement ps1 = con.prepareStatement(check);
            ps1.setInt(1, roomNo);
            ResultSet rs = ps1.executeQuery();

            if (!rs.next()) {
                System.out.println("Room not available.");
                return;
            }

            double price = rs.getDouble("price");
            double total = price * days;

            String insert = "INSERT INTO reservations (customer_name, room_number, days, total_amount) VALUES (?,?,?,?)";
            PreparedStatement ps2 = con.prepareStatement(insert);
            ps2.setString(1, name);
            ps2.setInt(2, roomNo);
            ps2.setInt(3, days);
            ps2.setDouble(4, total);
            ps2.executeUpdate();

            String update = "UPDATE rooms SET is_available=false WHERE room_number=?";
            PreparedStatement ps3 = con.prepareStatement(update);
            ps3.setInt(1, roomNo);
            ps3.executeUpdate();

            System.out.println("\nProcessing payment...");
            System.out.println("Payment Successful!");
            System.out.println("Booking Confirmed!");
            System.out.println("Total Amount: ₹" + total);

        } catch (Exception e) {
            System.out.println("Booking failed.");
        }
    }

    /* ---------- CANCEL RESERVATION ---------- */
    static void cancelReservation() {
        System.out.print("Enter customer name: ");
        String name = sc.nextLine();

        try (Connection con = DriverManager.getConnection(URL, USER, PASS)) {

            String getRoom = "SELECT room_number FROM reservations WHERE customer_name=?";
            PreparedStatement ps1 = con.prepareStatement(getRoom);
            ps1.setString(1, name);
            ResultSet rs = ps1.executeQuery();

            if (!rs.next()) {
                System.out.println("Reservation not found.");
                return;
            }

            int roomNo = rs.getInt("room_number");

            String delete = "DELETE FROM reservations WHERE customer_name=?";
            PreparedStatement ps2 = con.prepareStatement(delete);
            ps2.setString(1, name);
            ps2.executeUpdate();

            String update = "UPDATE rooms SET is_available=true WHERE room_number=?";
            PreparedStatement ps3 = con.prepareStatement(update);
            ps3.setInt(1, roomNo);
            ps3.executeUpdate();

            System.out.println("Reservation cancelled successfully.");

        } catch (Exception e) {
            System.out.println("Cancellation failed.");
        }
    }

    /* ---------- VIEW BOOKINGS ---------- */
    static void viewBookings() {
        try (Connection con = DriverManager.getConnection(URL, USER, PASS)) {

            String sql = "SELECT * FROM reservations";
            Statement st = con.createStatement();
            ResultSet rs = st.executeQuery(sql);

            System.out.println("\n--- BOOKING DETAILS ---");
            while (rs.next()) {
                System.out.println(
                        "Name: " + rs.getString("customer_name") +
                        " | Room: " + rs.getInt("room_number") +
                        " | Days: " + rs.getInt("days") +
                        " | Total: ₹" + rs.getDouble("total_amount")
                );
            }
        } catch (Exception e) {
            System.out.println("Error fetching bookings.");
        }
    }
}

